# Shared Specifications Between Plannies Projects

This document contains specifications that must be followed by both between plannies-mate and plannies-deploy projects.

See Also:
- SPECS.MD - specs specific to this project
- IMPLEMENTATION.md - implementation decisions made
- GUIDELINES.md - Guidelines for AIs and Developers (shared with plannies-mate)

Note: README.md is for setup and usage by the Developer

## `plannies-mate/log/scraper_analysis.js`

This file is generated by plannies-mate, copied in by planners-deploy and consumed by the WhatsThat frontend.
The format must be exactly as follows:

```javascript
// Generated by Plannies Mate at YYYY-MM-DD HH:MM:SS TZ
// for NN active scrapers

// the date and time the github repo list was last checked and downloaded
export const scraperDateTime = "2025-01-29T23:33:13Z";

export const scraperData = {
    'repo_name': {
        description: "Github repo description",
        words_from_description: ["unique", "words", "from", "name", "or", "description"],
        words_from_strings: ["unique", "words", "from", "code"],
        words_from_urls: ["unique", "words", "from", "urls"],
        url_patterns: ["/meaningful/url/patterns"]
    }
    // ... more scrapers
};
```

### Word Extraction Rules

Both projects MUST understand this exact algorithm was used for extracting and processing words:

1. Mate extracts urls from the text:
    - Finding URLs matching: `/https?:\/\/[^'"]+/`
    - Removing scheme/hostname: `/https?:\/\/[^\/]*/`
    - `words_from_urls` where derived using the word method below applied to urls
    - `url_patterns` are longer text from urls that appear to be significant

2. Mate extracts text from single and double-quoted strings in the code and processes the words to generate
   `words_from_strings`

3. Mate extracts text from the repo name and description and processes the words to generate
   `words_from_description`

4. Mate extracts words from text that match: `/[-_%a-z0-9]+/i`
    - There is no special handling of camelCase, snake_case, or kebab-case
        - These become single words in this context
    - Mate removes certain words to reduce false positives

5. Mate converts all words to lowercase. The case of url_patterns is left alone.

Note the "Crikey! What's That?" frontend uses these arrays as follows to be compatible with how they where
generated:

- `words_from_urls`, `words_from_description` and `words_from_strings` arrays contain only lowercase strings and:
    - MUST be matched case-insensitively and
    - MUST have a preceding and following non word character, ie that matches `/[^-_%a-z0-9]/i`
- `url_patterns` array contains case-sensitive strings and MUST be matched exactly as is,
  WITHOUT constraint on the preceding or following character.

## Content for web site

The plannies-mate log directory must follow this structure for plannies-deploy to pick up and deploy.

```
log/
├── assets/
|   └── js
|       └── scraper_analysis.js    # Generated frontend data
└── content/
    ├── authorities/        # files to be themed and placed in authorites directory
    │   └── index.html      # to override teh default.html file initially deployed
    └── repos/              # files to be themed and places in repos directory
        └── index.html      # to override teh default.html file initially deployed
```

Note: The spec of what exactly is provided in the content directory is up to plannies-mate's SPEC.md, aside from 
menu.html's general description and links.
